{
	"nodes":[
	<% # First list entity %>
		{"name":"<%= @entity.name %>","group":"entity","url":"<%= url_for @entity %>"},
		
	<% # Then list all projects under by the entity
		@entity.projects.each do |p| %>
		{"name":"<%= number_to_short( p.received ) %>","group":"project","url":"<%= url_for p %>"},
	<% end %>
	
	<% # Then list institutions funding each project
		@entity.institutions.each do |i| %>
		{"name":"<%= i.shortname %>","group":"institution","url":"<%= url_for i %>"}<% unless i == @entity.institutions.last %>,<% end %>
	<% end %>
	],
	
	"links":[
	<% # Next link entity to projects through subsidies
		@entity.projects.each_with_index do |p,index| %>
		{"source":0,"target":<%= index + 1 %>,"value":<%= p.received %>,"notes":"<%= @entity.name %> - <%= p.name %>"},
	<% end %>
	
	<% # Then link each project to its institution
		@entity.projects.each_with_index do |p,pindex|
			@entity.institutions.each_with_index do |i,iindex|
				if i.projects.include? p %>
					{"source":<%= pindex + 1 %>,"target":<%= iindex + @entity.projects.size + 1 %>,"value":<%= p.received %>,"notes":"<%= p.name %> - <%= i.name %>"}<% unless i == p.institutions.last and p == @entity.projects.last %>,<% end %>
				<% end
			end
		end %>
	]
}