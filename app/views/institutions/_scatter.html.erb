<div id="graph"></div>

<script>
	var w = 970, h = 640;
	var graph = d3.select("#graph").append("svg:svg").attr("width", w).attr("height", h);

	// Functions
	scale_x = d3.scale.linear().domain([0,1]).range([100,w-100]);
	scale_r = d3.scale.linear().domain([0,3000000000]).range([25,100]);
	
	d3.json('<%= request.url %>.json', function(json) {
	
	// Circles
	graph.selectAll("circle")
		.data((json.institutions)
  			.filter(function(d) { return (d.awarded > 0); }))
		.enter().append("svg:circle")
			.attr("cx", function(d) { return scale_x(d.ratio); })
			.attr("cy", function(d) { return h/2; })
			.attr("r", function(d) { return scale_r(d.awarded); })
			.style("fill", function(d) { return d3.interpolateRgb("#600", "#6f6")(d.ratio); })
			.on("click", function(d) { location.href = d.url; });
			
			//console.log( json.institutions );

	// Labels	

	graph.selectAll("text")
		.data((json.institutions)
  			.filter(function(d) { return (d.awarded > 0); }))
		.enter().append("svg:text")
			.attr("x", function(d) { return scale_x(d.ratio); })
			.attr("y", function(d) { return h/2; })
			.attr("text-anchor","middle")
			.text(function(d) { return d.abbreviation; });

	});
	

</script>

<style>
	#graph circle {stroke:#fff; opacity:0.75;}
		#graph circle:hover {opacity:1;}
	#graph text {fill:#fff; font-family:Diavlo;}
</style>