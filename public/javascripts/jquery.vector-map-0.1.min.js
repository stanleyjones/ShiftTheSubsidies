/*! jVectorMap version 0.1 | Copyright 2011, Kirill Lebedev | Licensed under the MIT license. */
(function(a){var b={colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1};var c={onLabelShow:"labelShow",onRegionOver:"regionMouseOver",onRegionOut:"regionMouseOut",onRegionClick:"regionClick"};a.fn.vectorMap=function(d){var f={map:"world_en",backgroundColor:"#505050",color:"#ffffff",hoverColor:"black",scaleColors:["#b6d6ff","#005ace"],normalizeFunction:"linear"},g;if(d==="addMap"){e.maps[arguments[1]]=arguments[2]}else if(d==="set"&&b[arguments[1]]){this.data("mapObject")["set"+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1)].apply(this.data("mapObject"),Array.prototype.slice.call(arguments,2))}else{a.extend(f,d);f.container=this;this.css({position:"relative",overflow:"hidden"});g=new e(f);this.data("mapObject",g);for(var h in c){if(f[h]){this.bind(c[h]+".jvectormap",f[h])}}}};var d=function(a,b){this.mode=window.SVGAngle?"svg":"vml";if(this.mode=="svg"){this.createSvgNode=function(a){return document.createElementNS(this.svgns,a)}}else{try{if(!document.namespaces.rvml){document.namespaces.add("rvml","urn:schemas-microsoft-com:vml")}this.createVmlNode=function(a){return document.createElement("<rvml:"+a+' class="rvml">')}}catch(c){this.createVmlNode=function(a){return document.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}if(this.mode=="svg"){this.canvas=this.createSvgNode("svg")}else{this.canvas=this.createVmlNode("group");this.canvas.style.position="absolute"}this.setSize(a,b)};d.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(a,b){if(this.mode=="svg"){this.canvas.setAttribute("width",a);this.canvas.setAttribute("height",b)}else{this.canvas.style.width=a+"px";this.canvas.style.height=b+"px";this.canvas.coordsize=a+" "+b;this.canvas.coordorigin="0 0";if(this.rootGroup){var c=this.rootGroup.getElementsByTagName("shape");for(var d=0,e=c.length;d<e;d++){c[d].coordsize=a+" "+b;c[d].style.width=a+"px";c[d].style.height=b+"px"}this.rootGroup.coordsize=a+" "+b;this.rootGroup.style.width=a+"px";this.rootGroup.style.height=b+"px"}}this.width=a;this.height=b},createPath:function(a){var b;if(this.mode=="svg"){b=this.createSvgNode("path");b.setAttribute("d",a.path);b.setFill=function(a){this.setAttribute("fill",a)};b.getFill=function(a){return this.getAttribute("fill")};b.setOpacity=function(a){this.setAttribute("fill-opacity",a)}}else{b=this.createVmlNode("shape");b.coordorigin="0 0";b.coordsize=this.width+" "+this.height;b.style.width=this.width+"px";b.style.height=this.height+"px";b.fillcolor=e.defaultFillColor;b.stroked=false;b.path=d.pathSvgToVml(a.path);var c=this.createVmlNode("skew");c.on=true;c.matrix="0.01,0,0,0.01,0,0";c.offset="0,0";b.appendChild(c);var f=this.createVmlNode("fill");b.appendChild(f);b.setFill=function(a){this.getElementsByTagName("fill")[0].color=a};b.getFill=function(a){return this.getElementsByTagName("fill")[0].color};b.setOpacity=function(a){this.getElementsByTagName("fill")[0].opacity=parseInt(a*100)+"%"}}return b},createGroup:function(a){var b;if(this.mode=="svg"){b=this.createSvgNode("g")}else{b=this.createVmlNode("group");b.style.width=this.width+"px";b.style.height=this.height+"px";b.style.left="0px";b.style.top="0px";b.coordorigin="0 0";b.coordsize=this.width+" "+this.height}if(a){this.rootGroup=b}return b},applyTransformParams:function(a,b,c){if(this.mode=="svg"){this.rootGroup.setAttribute("transform","scale("+a+") translate("+b+", "+c+")")}else{this.rootGroup.coordorigin=this.width-b+","+(this.height-c);this.rootGroup.coordsize=this.width/a+","+this.height/a}}};d.pathSvgToVml=function(a){var b="";var c=0,d=0,e,f;return a.replace(/([MmLlHhVvCcSs])((?:-?(?:\d+)?(?:\.\d+)?,?\s?)+)/g,function(a,b,g,h){g=g.replace(/(\d)-/g,"$1,-").replace(/\s+/g,",").split(",");if(!g[0])g.shift();for(var i=0,j=g.length;i<j;i++){g[i]=Math.round(100*g[i])}switch(b){case"m":c+=g[0];d+=g[1];return"t"+g.join(",");break;case"M":c=g[0];d=g[1];return"m"+g.join(",");break;case"l":c+=g[0];d+=g[1];return"r"+g.join(",");break;case"L":c=g[0];d=g[1];return"l"+g.join(",");break;case"h":c+=g[0];return"r"+g[0]+",0";break;case"H":c=g[0];return"l"+c+","+d;break;case"v":d+=g[0];return"r0,"+g[0];break;case"V":d=g[0];return"l"+c+","+d;break;case"c":e=c+g[g.length-4];f=d+g[g.length-3];c+=g[g.length-2];d+=g[g.length-1];return"v"+g.join(",");break;case"C":e=g[g.length-4];f=g[g.length-3];c=g[g.length-2];d=g[g.length-1];return"c"+g.join(",");break;case"s":g.unshift(d-f);g.unshift(c-e);e=c+g[g.length-4];f=d+g[g.length-3];c+=g[g.length-2];d+=g[g.length-1];return"v"+g.join(",");break;case"S":g.unshift(d+d-f);g.unshift(c+c-e);e=g[g.length-4];f=g[g.length-3];c=g[g.length-2];d=g[g.length-1];return"c"+g.join(",");break}return""}).replace(/z/g,"")};var e=function(b){b=b||{};var c=this;var g=e.maps[b.map];this.container=b.container;this.defaultWidth=g.width;this.defaultHeight=g.height;this.color=b.color;this.hoverColor=b.hoverColor;this.setBackgroundColor(b.backgroundColor);this.width=b.container.width();this.height=b.container.height();this.resize();a(window).resize(function(){c.width=b.container.width();c.height=b.container.height();c.resize();c.canvas.setSize(c.width,c.height);c.applyTransform()});this.canvas=new d(this.width,this.height);b.container.append(this.canvas.canvas);this.makeDraggable();this.rootGroup=this.canvas.createGroup(true);this.index=e.mapIndex;this.label=a("<div/>").addClass("jvectormap-label").appendTo(a("body"));a("<div/>").addClass("jvectormap-zoomin").text("+").appendTo(b.container);a("<div/>").addClass("jvectormap-zoomout").html("&#x2212;").appendTo(b.container);for(var h in g.pathes){var i=this.canvas.createPath({path:g.pathes[h].path});i.setFill(this.color);i.id="jvectormap"+c.index+"_"+h;c.countries[h]=i;a(this.rootGroup).append(i)}a(b.container).delegate(this.canvas.mode=="svg"?"path":"shape","mouseover mouseout",function(d){var e=d.target,f=d.target.id.split("_").pop(),h=a.Event("labelShow.jvectormap"),i=a.Event("regionMouseOver.jvectormap");if(d.type=="mouseover"){a(b.container).trigger(i,[f]);if(!i.isDefaultPrevented()){if(b.hoverOpacity){e.setOpacity(b.hoverOpacity)}if(b.hoverColor){e.currentFillColor=e.getFill()+"";e.setFill(b.hoverColor)}}c.label.text(g.pathes[f].name);a(b.container).trigger(h,[c.label,f]);if(!h.isDefaultPrevented()){c.label.show();c.labelWidth=c.label.width();c.labelHeight=c.label.height()}}else{e.setOpacity(1);if(e.currentFillColor){e.setFill(e.currentFillColor)}c.label.hide();a(b.container).trigger("regionMouseOut.jvectormap",[f])}});a(b.container).delegate(this.canvas.mode=="svg"?"path":"shape","click",function(c){var d=c.target;var e=c.target.id.split("_").pop();a(b.container).trigger("regionClick.jvectormap",[e])});b.container.mousemove(function(a){if(c.label.is(":visible")){c.label.css({left:a.pageX-15-c.labelWidth,top:a.pageY-15-c.labelHeight})}});this.setColors(b.colors);this.canvas.canvas.appendChild(this.rootGroup);this.applyTransform();this.colorScale=new f(b.scaleColors,b.normalizeFunction,b.valueMin,b.valueMax);if(b.values){this.values=b.values;this.setValues(b.values)}this.bindZoomButtons();e.mapIndex++};e.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,countries:{},countriesColors:{},countriesData:{},zoomStep:1.4,zoomMaxStep:4,zoomCurStep:1,setColors:function(a,b){if(typeof a=="string"){this.countries[a].setFill(b)}else{var c=a;for(var d in c){if(this.countries[d]){this.countries[d].setFill(c[d])}}}},setValues:function(a){var b=0,c=Number.MAX_VALUE,d;for(var e in a){d=parseFloat(a[e]);if(d>b)b=a[e];if(d&&d<c)c=d}this.colorScale.setMin(c);this.colorScale.setMax(b);var f={};for(e in a){d=parseFloat(a[e]);if(d){f[e]=this.colorScale.getColor(d)}else{f[e]=this.color}}this.setColors(f);this.values=a},setBackgroundColor:function(a){this.container.css("background-color",a)},setScaleColors:function(a){this.colorScale.setColors(a);if(this.values){this.setValues(this.values)}},setNormalizeFunction:function(a){this.colorScale.setNormalizeFunction(a);if(this.values){this.setValues(this.values)}},resize:function(){var a=this.baseScale;if(this.width/this.height>this.defaultWidth/this.defaultHeight){this.baseScale=this.height/this.defaultHeight;this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)}else{this.baseScale=this.width/this.defaultWidth;this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale)}this.scale*=this.baseScale/a;this.transX*=this.baseScale/a;this.transY*=this.baseScale/a},reset:function(){this.countryTitle.reset();for(var a in this.countries){this.countries[a].setFill(e.defaultColor)}this.scale=this.baseScale;this.transX=this.baseTransX;this.transY=this.baseTransY;this.applyTransform()},applyTransform:function(){var a,b,c,b;if(this.defaultWidth*this.scale<=this.width){a=(this.width-this.defaultWidth*this.scale)/(2*this.scale);c=(this.width-this.defaultWidth*this.scale)/(2*this.scale)}else{a=0;c=(this.width-this.defaultWidth*this.scale)/this.scale}if(this.defaultHeight*this.scale<=this.height){b=(this.height-this.defaultHeight*this.scale)/(2*this.scale);minTransY=(this.height-this.defaultHeight*this.scale)/(2*this.scale)}else{b=0;minTransY=(this.height-this.defaultHeight*this.scale)/this.scale}if(this.transY>b){this.transY=b}else if(this.transY<minTransY){this.transY=minTransY}if(this.transX>a){this.transX=a}else if(this.transX<c){this.transX=c}this.canvas.applyTransformParams(this.scale,this.transX,this.transY)},makeDraggable:function(){var a=false;var b,c;var d=this;this.container.mousemove(function(e){if(a){var f=d.transX;var g=d.transY;d.transX-=(b-e.pageX)/d.scale;d.transY-=(c-e.pageY)/d.scale;d.applyTransform();b=e.pageX;c=e.pageY}return false}).mousedown(function(d){a=true;b=d.pageX;c=d.pageY;return false}).mouseup(function(){a=false;return false})},bindZoomButtons:function(){var b=this;var c=(a("#zoom").innerHeight()-6*2-15*2-3*2-7-6)/(this.zoomMaxStep-this.zoomCurStep);this.container.find(".jvectormap-zoomin").click(function(){if(b.zoomCurStep<b.zoomMaxStep){var d=b.transX;var e=b.transY;var f=b.scale;b.transX-=(b.width/b.scale-b.width/(b.scale*b.zoomStep))/2;b.transY-=(b.height/b.scale-b.height/(b.scale*b.zoomStep))/2;b.setScale(b.scale*b.zoomStep);b.zoomCurStep++;a("#zoomSlider").css("top",parseInt(a("#zoomSlider").css("top"))-c)}});this.container.find(".jvectormap-zoomout").click(function(){if(b.zoomCurStep>1){var d=b.transX;var e=b.transY;var f=b.scale;b.transX+=(b.width/(b.scale/b.zoomStep)-b.width/b.scale)/2;b.transY+=(b.height/(b.scale/b.zoomStep)-b.height/b.scale)/2;b.setScale(b.scale/b.zoomStep);b.zoomCurStep--;a("#zoomSlider").css("top",parseInt(a("#zoomSlider").css("top"))+c)}})},setScale:function(a){this.scale=a;this.applyTransform()},getCountryPath:function(b){return a("#"+b)[0]}};e.xlink="http://www.w3.org/1999/xlink";e.mapIndex=1;e.maps={};var f=function(a,b,c,d){if(a)this.setColors(a);if(b)this.setNormalizeFunction(b);if(c)this.setMin(c);if(c)this.setMax(d)};f.prototype={colors:[],setMin:function(a){this.clearMinValue=a;if(typeof this.normalize==="function"){this.minValue=this.normalize(a)}else{this.minValue=a}},setMax:function(a){this.clearMaxValue=a;if(typeof this.normalize==="function"){this.maxValue=this.normalize(a)}else{this.maxValue=a}},setColors:function(a){for(var b=0;b<a.length;b++){a[b]=f.rgbToArray(a[b])}this.colors=a},setNormalizeFunction:function(a){if(a==="polynomial"){this.normalize=function(a){return Math.pow(a,.2)}}else if(a==="linear"){delete this.normalize}else{this.normalize=a}this.setMin(this.clearMinValue);this.setMax(this.clearMaxValue)},getColor:function(a){if(typeof this.normalize==="function"){a=this.normalize(a)}var b=[];var c=0;var d;for(var e=0;e<this.colors.length-1;e++){d=this.vectorLength(this.vectorSubtract(this.colors[e+1],this.colors[e]));b.push(d);c+=d}var f=(this.maxValue-this.minValue)/c;for(e=0;e<b.length;e++){b[e]*=f}e=0;a-=this.minValue;while(a-b[e]>=0){a-=b[e];e++}var g;if(e==this.colors.length-1){g=this.vectorToNum(this.colors[e]).toString(16)}else{g=this.vectorToNum(this.vectorAdd(this.colors[e],this.vectorMult(this.vectorSubtract(this.colors[e+1],this.colors[e]),a/b[e]))).toString(16)}while(g.length<6){g="0"+g}return"#"+g},vectorToNum:function(a){var b=0;for(var c=0;c<a.length;c++){b+=Math.round(a[c])*Math.pow(256,a.length-c-1)}return b},vectorSubtract:function(a,b){var c=[];for(var d=0;d<a.length;d++){c[d]=a[d]-b[d]}return c},vectorAdd:function(a,b){var c=[];for(var d=0;d<a.length;d++){c[d]=a[d]+b[d]}return c},vectorMult:function(a,b){var c=[];for(var d=0;d<a.length;d++){c[d]=a[d]*b}return c},vectorLength:function(a){var b=0;for(var c=0;c<a.length;c++){b+=a[c]*a[c]}return Math.sqrt(b)}};f.arrayToRgb=function(a){var b="#";var c;for(var d=0;d<a.length;d++){c=a[d].toString(16);b+=c.length==1?"0"+c:c}return b};f.rgbToArray=function(a){a=a.substr(1);return[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]}})(jQuery)